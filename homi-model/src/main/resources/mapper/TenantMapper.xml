<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.homi.model.dao.mapper.TenantMapper">

    <select id="getStatusTotal" resultType="com.homi.model.tenant.vo.TenantTotalItemVO">
        select t.status,
        count(*) as total
        from tenant t
        where t.deleted = false
        <include refid="tenantListQuery"/>
        group by t.status
    </select>

    <sql id="tenantListQuery">
        <if test="query.name != null and query.name != ''">
            and t.tenant_name like concat('%', #{query.name,jdbcType=VARCHAR}, '%')
        </if>

        <if test="query.phone != null and query.phone != ''">
            and t.tenant_phone =
            #{query.phone,jdbcType=VARCHAR}
        </if>
        <if test="query.tenantType != null">
            and t.tenant_type = #{query.tenantType,jdbcType=INTEGER}
        </if>
        <if test="query.status != null">
            and t.status = #{query.status,jdbcType=INTEGER}
        </if>
        <if test="query.roomId != null">
            WHERE JSON_CONTAINS(t.room_ids,JSON_ARRAY('${query.roomId}'))
        </if>
    </sql>

    <select id="pageTenantList" resultType="com.homi.model.tenant.vo.TenantListVO">
        SELECT t.*
        FROM tenant t
        where t.deleted = false
        <include refid="tenantListQuery"/>
        order by t.id DESC
    </select>
</mapper>
